# Fat Clip

一个遵循 Material Design、基于 Tauri 的跨平台本地剪切板管理应用。

## 概述

Fat Clip 致力于成为轻量、高效且私有化的剪切板历史与管理工具，帮助用户记录、搜索、分类并安全管理任意类型的剪贴内容（文本、富文本、图片、文件引用等）。

## 目标

- 提供即时且低资源消耗的剪贴监听与保存能力。
- 支持强大的搜索与 Tag/分类机制，方便用户快速定位历史剪贴项。
- 提供可配置的保留与清理策略，以及导入/导出能力，保证数据可控与可迁移。
- 保证所有数据在本地存储、注重隐私与安全设计。

## 范围（MVP 与增强）

- MVP（第一版本重点）：剪贴监听、历史记录（无限/按策略）、基本搜索、Tag、时间轴视图、常用快捷键与复制回剪贴板。  
- 增强（后续迭代）：内容预览（富文本/图片）、智能摘要/高亮、同步/导出插件（仅用户显式操作）、自动分组规则、剪贴模板、OCR 支持。

## 关键用户画像（Personas）

- 开发者
	- 描述：日常在 IDE、终端和文档之间切换，频繁复制代码片段、命令、配置和注释。
	- 主要需求：快速检索历史代码片段、保持剪贴板隐私、不希望大文件/图片打扰列表。
	- 行为场景：在编码过程中需要重复粘贴常用片段或回溯之前的实现细节。
	- 成功衡量：平均检索并恢复目标片段耗时 < 5s，剪贴条目可按项目/语言过滤。

- 产品设计师
	- 描述：常截屏、拷贝图像与富文本，需对视觉内容进行临时管理与注释。
	- 主要需求：图片缩略预览、富文本渲染、收藏与分组、快速导出图片或拖拽到设计工具。
	- 行为场景：将多张设计稿临时保存为剪贴项并按项目或任务分组，随后重用或导出。
	- 成功衡量：图片预览可用、从历史恢复图片并拖放到目标应用成功率 > 95%。

- 商务用户
	- 描述：以文档与表单为主，频繁复制地址、订单号、账号等结构化文本。
	- 主要需求：强搜索（按关键字段）、标签快速定位、复制后自动格式化（如去空格）选项。
	- 行为场景：查找上次复制的订单号并快速粘贴到 CRM 或表单中。
	- 成功衡量：按关键词检索命中率高、常用条目能被“一键复制”并保持原始格式。

- 高级用户（可选）
	- 描述：需要更强自定义和自动化（例如脚本、规则或模版）的一类用户。
	- 主要需求：规则引擎、自动标签、导入/导出脚本接口、可编程快捷动作。
	- 行为场景：为特定来源（如 Slack 或浏览器）设置自动分组规则并标记重要条目。
	- 成功衡量：规则能自动筛选并标注 > 80% 的目标剪贴项，节省重复整理时间。

## 用户旅程（简要）

- 场景：用户在编辑文档时复制了一段文本 -> Fat Clip 自动记录 -> 用户按快捷键唤出历史 -> 搜索/筛选到目标条目 -> 回车或点击将内容恢复到系统剪贴板 -> 粘贴。

## 功能清单（详细）

以下将功能拆解为可实现的子功能，并为每项给出可测试的验收标准（AC）。

- 剪贴监听与采集
	- 功能：在后台监听系统剪贴板并捕获新条目，支持纯文本、富文本（RTF/HTML）、图片与文件引用。
	- AC：任意应用复制内容后 100ms 内在历史中可见；不同应用来源记录为 distinct `sourceApp`。

- 存储与去重
	- 功能：将剪贴条目持久化到本地 DB（推荐 SQLite + FTS），对大二进制采用文件引用，支持去重策略与保留策略。
	- AC：相同内容在连续复制时按去重策略不重复存储；数据库支持全文检索并在 200ms 内返回结果（小数据集）。

- 搜索与筛选
	- 功能：支持全文（FTS）搜索、正则搜索、按 Tag、时间范围与来源过滤，并高亮匹配片段。
	- AC：在 1,000 条示例数据上全文搜索返回结果 < 100ms；支持 `tag:工作`、`source:Chrome` 等过滤语法。

- Tag 与元数据管理
	- 功能：为条目添加/编辑/批量删除 Tag；支持多选批量标注与智能建议 Tag。
	- AC：对选中 10 条条目批量添加 Tag 的操作在 200ms 内完成，Tag 可用于过滤搜索结果。

- 视图与预览
	- 功能：提供列表视图、时间轴视图与条目预览（文本展开、图片缩略）；支持拖拽导出文件引用。
	- AC：图片项显示缩略图且点击预览不超过 100ms；拖拽文件引用到桌面生成实际文件。

- 快捷键与快速唤出
	- 功能：全局可配置唤出快捷键、列表内键盘导航（↑/↓）、预览（Space）与粘贴（Enter）。
	- AC：按下全局快捷键能在 100ms 内唤出面板，键盘即可完成搜索、选择并回车复制到系统剪贴板。

- 恢复与外部粘贴
	- 功能：将条目内容恢复到系统剪贴板，支持原格式（富文本/图片）恢复；支持“直接粘贴到前台应用”（平台能力限制下可选）。
	- AC：选中条目回车后系统剪贴板内容与原始内容一致（文本/图片），并能在目标应用粘贴复现。

- 导入/导出与备份
	- 功能：导出/导入 JSON、CSV 与 Markdown；提供数据库备份与恢复功能；导出时可选择是否包含二进制附件。
	- AC：导出一组 100 条条目并重新导入后，条目与 Tag 完整恢复；大附件可选择以引用或打包方式导出。

- 清理与保留策略
	- 功能：按时间范围、条目类型、大小或 Tag 自动清理；支持保留被置顶/收藏的条目。
	- AC：配置“保留最近 30 天”后旧条目被正确删除；手动恢复最近一次清理（撤销）可用。

- 权限、隐私与加密
	- 功能：所有数据默认本地存储；提供可选数据库加密、导出时的敏感信息提示与选择性导出。
	- AC：启用加密后数据库在未解密情况下不可读；导出流程向用户显示敏感数据警告。

- 高级规则与自动化（增强）
	- 功能：用户可建立规则（基于正则、来源、关键词）自动打 Tag/跳过/归档；支持模板与动作链。
	- AC：新建规则后对新入库条目自动生效（示例测试用例通过率 > 90%）。

- 性能与后台任务
	- 功能：异步索引、后台清理与预览缩略图生成；监控内存与磁盘使用并在设置显示统计信息。
	- AC：常驻内存在正常负载下控制在目标范围内，后台索引/缩略图任务不影响主流程响应。

以上子功能将作为 MVP 与后续迭代的拆分单元，便于分工与估时。


## 非功能需求

- 性能：启动后常驻内存占用低于 50MB（目标值），剪贴写入延迟 < 50ms。  
- 可用性：唤出界面响应 < 100ms，支持无障碍操作与高对比主题。  
- 可移植性：Windows/macOS/Linux（通过 Tauri 打包）。

## 隐私与安全

- 所有数据仅保存在本地数据库（例如 SQLite 或类似嵌入式存储），不开启默认网络访问。  
- 提供加密选项（用户选择性加密数据库或特定条目），并在设置中明确说明风险与恢复方法。  
- 导出时提醒用户包含敏感信息并支持选择性导出。

## 数据模型（建议）

- ClipItem
	- id: string (UUID)
	- contentType: enum (plain, rich, image, file)
	- content: blob/text (根据类型存储或文件引用)
	- previewText: string (用于搜索/快速展示)
	- tags: string[]
	- sourceApp: string
	- createdAt: datetime
	- lastUsedAt: datetime
	- pinned: boolean
	- metadata: json (尺寸、mime、附件路径等)

## 存储与索引

- 使用 SQLite + FTS（全文检索）或类似轻量索引，保证搜索性能。  
- 图片/大二进制可存为应用数据目录下的文件，并在 DB 中保存引用路径。

## UI / 交互 指南（简要）

- 视觉：遵循 Material Design 原则，支持浅色/深色主题与系统主题同步。  
- 结构：左侧为过滤与 Tag 列表，右侧为时间轴/列表，顶部为搜索栏与快捷操作。  
- 交互：列表项支持快捷键选中、预览（空格/快速键）和粘贴（Enter），支持拖放到外部应用（文件引用场景）。

## 键盘与快捷键（建议）

- 全局唤出：`Ctrl+Shift+V`（可配置）  
- 上下选择：`↑` / `↓`  
- 复制到系统剪贴板/粘贴：`Enter`  
- 预览/展开：`Space`  
- 标签管理：`T`（快速添加）  
- 搜索焦点：`/` 或 `Ctrl+F`

## 可访问性

- 支持键盘全操作与屏幕阅读器文本，使用语义化控件与合适 ARIA 标签。  
- 颜色对比满足 WCAG AA 标准，提供高对比主题选项。

## 路线与里程碑（建议）

- 里程碑 1（2 周）：MVP 核心监听、历史存储、基础搜索与唤出。  
- 里程碑 2（4 周）：Tag 管理、时间轴视图、设置面板与导入导出。  
- 里程碑 3（6-8 周）：内容预览、智能分组、加密选项与性能优化。

## 验收标准（示例）

- 剪贴后的条目能在 < 100ms 内出现在历史中并可被搜索到。  
- 全局唤出在 100ms 内弹出并可通过键盘完成粘贴操作。  
- 存储策略能按用户设置正确删除历史项并可导出剩余数据。

## 后续工作建议

- 准备简单的 UI 原型（Figma 或图片）并验证关键交互。  
- 定义配置项的用户可见文案与国际化字符串。  
- 评估并选定本地数据库与索引技术（SQLite+FTS 推荐）。

---

## 工作模式

以下工作模式用于降低 AI 在长任务中的上下文丢失、记忆混乱，以及新会话无法延续的问题。

### 1) 记忆分层（必须执行）

- L0 临时上下文（会话内）
	- 内容：当前消息、临时推理、即时命令输出。
	- 生命周期：仅当前会话有效，不作为唯一事实来源。

- L1 会话记忆（可恢复）
	- 内容：当前阶段目标、进行中任务、关键决策、未完成事项。
	- 存储：`docs/agent/session-memory.md`。
	- 更新时机：每完成一个子任务或发生方向变化后立即更新。

- L2 项目记忆（长期稳定）
	- 内容：项目目标、架构约束、术语约定、里程碑与验收口径。
	- 存储：本文件 `AGENTS.md` 与相关长期文档。
	- 更新时机：需求或策略发生“稳定变化”时更新。

原则：**短期信息不能覆盖长期事实；任何关键结论必须落到 L1 或 L2。**

### 2) 标准会话流程（SOP）

- 阶段 A：会话启动（3 分钟）
	- 读取 `AGENTS.md`、`README.md`、`docs/agent/session-memory.md`（若存在）。
	- 产出“本会话目标三行摘要”：目标、范围外、完成定义（DoD）。
	- 若发现目标冲突，以 `AGENTS.md` 为准并记录冲突说明。

- 阶段 B：执行循环（持续）
	- 采用“微计划 -> 执行 -> 验证 -> 记录”循环。
	- 每轮仅推进一个最小可验证增量（MVI）。
	- 任何实现决策都要记录“原因 + 备选方案 + 影响范围”。

- 阶段 C：检查点（每 15–30 分钟或每 5 次工具操作）
	- 回写 `docs/agent/session-memory.md` 的四项：
		1. 当前进度（Done）
		2. 当前阻塞（Blockers）
		3. 下一步（Next）
		4. 风险与假设（Risks/Assumptions）
	- 若上下文变长，先做摘要再继续，避免“历史噪音”淹没关键信息。

- 阶段 D：会话收尾（必须）
	- 生成交接块（Handoff）：
		- 本次完成
		- 未完成与原因
		- 下一会话第一步
		- 需要重点关注的文件/命令
	- 将交接块写入 `docs/agent/session-memory.md` 顶部。

### 3) 防丢失机制（强制约束）

- 单一事实源
	- “需求与约束”只认 `AGENTS.md`。
	- “本阶段状态”只认 `docs/agent/session-memory.md` 最新块。

- 双写关键决策
	- 关键决策同时写入：
		- 决策列表（Decision Log）
		- 对应实现位置（文件路径 + 目的）

- 禁止隐式状态
	- 不依赖“我记得刚才做过”的隐式记忆。
	- 任何未写入文档的状态，视为不存在。

- 上下文预算控制
	- 长会话中优先保留：目标、约束、未完成事项、最新决策。
	- 细节日志压缩为要点，必要时追加到附录而非主记忆区。

### 4) 新会话恢复协议（Cold Start）

新会话必须按以下顺序恢复，不得跳步：

1. 读取 `AGENTS.md`，确认长期目标与边界。
2. 读取 `docs/agent/session-memory.md` 最新交接块。
3. 输出“恢复确认”四行：
	 - 我理解的目标
	 - 当前已完成
	 - 当前未完成
	 - 立即执行的第一步
4. 仅在恢复确认完成后开始编码或改文件。

若 `docs/agent/session-memory.md` 不存在，先创建并写入初始化模板再开始任务。

### 5) `session-memory.md` 推荐模板

```markdown
# Session Memory

## Current Goal
- 

## Scope Guardrails (Out of Scope)
- 

## Decisions (with rationale)
- [D-001] 决策：
	- 原因：
	- 备选：
	- 影响：

## Progress
- Done:
- In Progress:
- Next:

## Blockers
- 

## Risks / Assumptions
- 

## Handoff (Latest First)
### YYYY-MM-DD HH:mm
- 本次完成：
- 未完成：
- 下一步：
- 关键文件：
```

### 6) 执行纪律（简版）

- 先读后做：先同步记忆，再执行修改。
- 小步快跑：每次只做可验证的小改动。
- 逢变必记：目标/方案变化后立即回写记忆。
- 收尾必交接：没有交接块，不算完成本轮工作。


